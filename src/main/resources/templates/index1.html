<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Details - FeeEase</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <style>
        body {
          height: 100vh;
          display: flex;
          flex-direction: column;
        }
        .main-content {
          flex-grow: 1;
          display: flex;
          overflow: hidden;
        }
        .menu-section {
          background-color: #f8f9fa;
          width: 250px;
          padding: 20px;
          border-right: 1px solid #e9ecef;
          overflow-y: auto;
        }
        .menu-section a {
          color: #068388;
          font-weight: 500;
          display: block;
          padding: 10px;
          text-decoration: none;
          border-radius: 5px;
        }
        .menu-section a.active {
          color: #fff;
          background-color: #068388;
        }
        .menu-section a:hover {
          background-color: rgba(6, 131, 136, 0.1);
        }
        .content-section {
          flex-grow: 1;
          padding: 20px;
          overflow-y: auto;
        }
        .custom-add-user-tab {
          color: #068388 !important;
        }
        .custom-add-user-tab:hover {
          color: #fff !important;
          background-color: #056a6e !important;
          border-color: #056a6e !important;
        }
        .custom-spinner {
          color: #068388 !important;
        }
        #loadingSpinner {
          display: none !important;
        }
        .btn-custom {
          background-color: #068388;
          color: white;
        }
        .btn-custom:hover {
          background-color: #056a6e;
          color: white;
        }
        .action-buttons {
          display: flex;
          gap: 10px;
        }
    </style>
</head>
<body>
<!-- Header -->
<div th:replace="fragments/header :: header"></div>

<!-- Main Content -->
<div class="main-content">
    <!-- Sidebar (Menu Section) -->
    <div class="menu-section">
        <nav class="nav flex-column">
            <a class="nav-link" href="/fee_ease/dashboard">Dashboard</a>
            <a class="nav-link" href="/fee_ease/users">User Management</a>
            <a class="nav-link active" href="#">Student Management</a>
            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">Fees Management</a>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Fee Type</a></li>
                <li><a class="dropdown-item" href="#">Fees</a></li>
                <li><a class="dropdown-item" href="#">Reports</a></li>
            </ul>
        </nav>
    </div>

    <!-- Content Section -->
    <div class="content-section">
        <div class="container-fluid">
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="#">Students</a>
                </li>
                <li class="nav-item" th:if="${Role == 'Admin'}">
                    <a class="nav-link custom-add-user-tab" href="/fee_ease/students/add">Add/Edit Student</a>
                </li>
            </ul>
            <div class="row" style="margin-top:25px;">
                <div class="col-auto">
                    <label for="sessionSelect" class="form-label">Session : </label>
                </div>
                <div class="col-auto">
                    <select class="form-select" id="sessionSelect" name="sessionSelect">
                        <option selected>-- Select Session --</option>
                        <option th:each="ssn : ${SessionList}" th:value="${ssn.sessionName()}" th:text="${ssn.sessionName()}"></option>
                    </select>
                </div>
                <div class="col-auto">
                    <label for="standardSelect" class="form-label">Standard : </label>
                </div>
                <div class="col-auto">
                    <select class="form-select" id="standardSelect" name="standardSelect">
                        <option selected>-- Select Standard --</option>
                        <option th:each="standard : ${StandardList}" th:value="${standard.standard()}" th:text="${standard.standard()}"></option>
                    </select>
                </div>
                <div class="col-auto">
                    <button type="button" class="btn btn-custom" onclick="filterStudents()">Load Students</button>
                </div>
            </div>
            <div id="loadingSpinner" class="d-flex justify-content-center" style="display:none;">
                <div class="spinner-border custom-spinner" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
            <div class="row">
                <table id="studentTable" class="table table-striped" style="display: none; margin-top:25px;">
                    <thead>
                    <tr class="fw-bold" style="color:068388">
                        <th>S. No.</th>
                        <th>Student Name</th>
                        <th>Standard</th>
                        <th>Section</th>
                        <th>Date Of Birth</th>
                        <th>Session</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="studentTableBody">
                    <!-- Data will be loaded here via AJAX -->
                    </tbody>
                </table>
            </div>

        </div>
    </div>
</div>

<!-- Footer -->
<div th:replace="fragments/footer :: footer"></div>
<script>
    function confirmReset(event) {
        var confirmed = confirm("Are you sure you wish to reset password?");
        if (!confirmed) {
            event.preventDefault();
        }
    }

    function confirmEnableDisable(button, event) {
        var message = button.getAttribute('data-confirm-message');
        var confirmed = confirm(message);
        if (!confirmed) {
            event.preventDefault(); // Prevent form submission if not confirmed
        }
    }

    function filterStudents() {
      var session = $("#sessionSelect").val();
      var standard = $("#standardSelect").val();
      // Show Spinner
      $("#loadingSpinner").show();
      $("#studentTableBody").empty(); // Clear previous results

      $.ajax({
          url: "/fee_ease/students/filter",
          type: "GET",
          data: { session: session, standard: standard },
          success: function (data) {
              var tableBody = $("#studentTableBody");
              var idx = 1;
              var role = "[[${Role}]]"; // Passing Thymeleaf variable to JavaScript

              data.forEach(function (student) {
                  var row = "<tr>" +
                      "<td>" + idx + "</td>" +
                      "<td>" + student.name + "</td>" +
                      "<td>" + student.standard + "</td>" +
                      "<td>" + student.section + "</td>" +
                      "<td>" + student.dob + "</td>" +
                      "<td>" + student.session + "</td>";

                  // If user is Admin, add action buttons
                  if (role === "Admin") {
                      row += "<td class='action-buttons'>" +
                          "<form action='/fee_ease/students/view/" + student.id + "' method='get' style='display:inline;'>" +
                          "<button class='btn btn-primary'>View</button>" +
                          "</form>" +
                          "<form action='/fee_ease/students/edit/" + student.id + "' method='get' style='display:inline;'>" +
                          "<button type='submit' class='btn btn-warning'>Edit</button>" +
                          "</form>" +
                          "<form action='/fee_ease/" + (student.enabled ? "students/disable" : "students/enable") + "' method='post' style='display:inline;'>" +
                          "<input type='hidden' name='studentId' value='" + student.id + "'/>" +
                          "<button type='submit' class='" + (student.enabled ? "btn btn-danger" : "btn btn-success") + "'>" +
                          (student.enabled ? "Disable" : "Enable") +
                          "</button>" +
                          "</form>" +
                          "</td>";
                  }

                  row += "</tr>";

                  tableBody.append(row);
                  idx++;
              });
          },
          error: function() {
              alert("Error fetching student data. Please try again.");
          },
          complete: function() {
              setTimeout(function () {
                  // Hide Spinner after data is loaded
                  $("#studentTable").show();
                  $("#loadingSpinner").hide();
             [_{{{CITATION{{{_1{](https://github.com/teemax1/libdata/tree/e155f5a0c22c24ace34d6c627881b7bf30432acc/student-list.php)